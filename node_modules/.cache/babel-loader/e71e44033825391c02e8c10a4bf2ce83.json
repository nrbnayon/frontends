{"ast":null,"code":"import { useSafeLayoutEffect } from \"@chakra-ui/hooks\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\n/**\r\n * React hook that loads an image in the browser,\r\n * and let's us know the `status` so we can show image\r\n * fallback if it is still `pending`\r\n *\r\n * @returns the status of the image loading progress\r\n *\r\n * @example\r\n *\r\n * ```jsx\r\n * function App(){\r\n *   const status = useImage({ src: \"image.png\" })\r\n *   return status === \"loaded\" ? <img src=\"image.png\" /> : <Placeholder />\r\n * }\r\n * ```\r\n */\nexport function useImage(props) {\n  var {\n    src,\n    srcSet,\n    onLoad,\n    onError,\n    crossOrigin,\n    sizes,\n    ignoreFallback\n  } = props;\n  var [status, setStatus] = useState(\"pending\");\n  useEffect(() => {\n    setStatus(src ? \"loading\" : \"pending\");\n  }, [src]);\n  var imageRef = useRef();\n  var load = useCallback(() => {\n    if (!src) return;\n    flush();\n    var img = new Image();\n    img.src = src;\n    if (crossOrigin) {\n      img.crossOrigin = crossOrigin;\n    }\n    if (srcSet) {\n      img.srcset = srcSet;\n    }\n    if (sizes) {\n      img.sizes = sizes;\n    }\n    img.onload = event => {\n      flush();\n      setStatus(\"loaded\");\n      onLoad == null ? void 0 : onLoad(event);\n    };\n    img.onerror = error => {\n      flush();\n      setStatus(\"failed\");\n      onError == null ? void 0 : onError(error);\n    };\n    imageRef.current = img;\n  }, [src, crossOrigin, srcSet, sizes, onLoad, onError]);\n  var flush = () => {\n    if (imageRef.current) {\n      imageRef.current.onload = null;\n      imageRef.current.onerror = null;\n      imageRef.current = null;\n    }\n  };\n  useSafeLayoutEffect(() => {\n    /**\r\n     * If user opts out of the fallback/placeholder\r\n     * logic, let's bail out.\r\n     */\n    if (ignoreFallback) return undefined;\n    if (status === \"loading\") {\n      load();\n    }\n    return () => {\n      flush();\n    };\n  }, [status, load, ignoreFallback]);\n  /**\r\n   * If user opts out of the fallback/placeholder\r\n   * logic, let's just return 'loaded'\r\n   */\n\n  return ignoreFallback ? \"loaded\" : status;\n}","map":{"version":3,"names":["useSafeLayoutEffect","useCallback","useEffect","useRef","useState","useImage","props","src","srcSet","onLoad","onError","crossOrigin","sizes","ignoreFallback","status","setStatus","imageRef","load","flush","img","Image","srcset","onload","event","onerror","error","current","undefined"],"sources":["../../src/use-image.ts"],"sourcesContent":["import { useSafeLayoutEffect } from \"@chakra-ui/hooks\"\nimport {\n  ImgHTMLAttributes,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\nexport interface UseImageProps {\n  /**\n   * The image `src` attribute\n   */\n  src?: string\n  /**\n   * The image `srcset` attribute\n   */\n  srcSet?: string\n  /**\n   * The image `sizes` attribute\n   */\n  sizes?: string\n  /**\n   * A callback for when the image `src` has been loaded\n   */\n  onLoad?(event: React.SyntheticEvent<HTMLImageElement, Event>): void\n  /**\n   * A callback for when there was an error loading the image `src`\n   */\n  onError?(error: string | React.SyntheticEvent<HTMLImageElement, Event>): void\n  /**\n   * If `true`, opt out of the `fallbackSrc` logic and use as `img`\n   */\n  ignoreFallback?: boolean\n  /**\n   * The key used to set the crossOrigin on the HTMLImageElement into which the image will be loaded.\n   * This tells the browser to request cross-origin access when trying to download the image data.\n   */\n  crossOrigin?: ImgHTMLAttributes<any>[\"crossOrigin\"]\n}\n\ntype Status = \"loading\" | \"failed\" | \"pending\" | \"loaded\"\n\ntype ImageEvent = React.SyntheticEvent<HTMLImageElement, Event>\n\n/**\n * React hook that loads an image in the browser,\n * and let's us know the `status` so we can show image\n * fallback if it is still `pending`\n *\n * @returns the status of the image loading progress\n *\n * @example\n *\n * ```jsx\n * function App(){\n *   const status = useImage({ src: \"image.png\" })\n *   return status === \"loaded\" ? <img src=\"image.png\" /> : <Placeholder />\n * }\n * ```\n */\nexport function useImage(props: UseImageProps) {\n  const {\n    src,\n    srcSet,\n    onLoad,\n    onError,\n    crossOrigin,\n    sizes,\n    ignoreFallback,\n  } = props\n\n  const [status, setStatus] = useState<Status>(\"pending\")\n\n  useEffect(() => {\n    setStatus(src ? \"loading\" : \"pending\")\n  }, [src])\n\n  const imageRef = useRef<HTMLImageElement | null>()\n\n  const load = useCallback(() => {\n    if (!src) return\n\n    flush()\n\n    const img = new Image()\n\n    img.src = src\n\n    if (crossOrigin) {\n      img.crossOrigin = crossOrigin\n    }\n\n    if (srcSet) {\n      img.srcset = srcSet\n    }\n\n    if (sizes) {\n      img.sizes = sizes\n    }\n\n    img.onload = (event) => {\n      flush()\n      setStatus(\"loaded\")\n      onLoad?.((event as unknown) as ImageEvent)\n    }\n    img.onerror = (error) => {\n      flush()\n      setStatus(\"failed\")\n      onError?.(error as any)\n    }\n\n    imageRef.current = img\n  }, [src, crossOrigin, srcSet, sizes, onLoad, onError])\n\n  const flush = () => {\n    if (imageRef.current) {\n      imageRef.current.onload = null\n      imageRef.current.onerror = null\n      imageRef.current = null\n    }\n  }\n\n  useSafeLayoutEffect(() => {\n    /**\n     * If user opts out of the fallback/placeholder\n     * logic, let's bail out.\n     */\n    if (ignoreFallback) return undefined\n\n    if (status === \"loading\") {\n      load()\n    }\n    return () => {\n      flush()\n    }\n  }, [status, load, ignoreFallback])\n\n  /**\n   * If user opts out of the fallback/placeholder\n   * logic, let's just return 'loaded'\n   */\n  return ignoreFallback ? \"loaded\" : status\n}\n\nexport type UseImageReturn = ReturnType<typeof useImage>\n"],"mappings":"AAAA,SAASA,mBAAT,QAAoC,kBAApC;AACA,SAEEC,WAFF,EAGEC,SAHF,EAIEC,MAJF,EAKEC,QALF,QAMO,OANP;;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,QAATA,CAAkBC,KAAlB,EAAwC;EAC7C,IAAM;IACJC,GADI;IAEJC,MAFI;IAGJC,MAHI;IAIJC,OAJI;IAKJC,WALI;IAMJC,KANI;IAOJC;EAPI,IAQFP,KARJ;EAUA,IAAM,CAACQ,MAAD,EAASC,SAAT,IAAsBX,QAAQ,CAAS,SAAT,CAApC;EAEAF,SAAS,CAAC,MAAM;IACda,SAAS,CAACR,GAAG,GAAG,SAAH,GAAe,SAAnB,CAAT;EACD,CAFQ,EAEN,CAACA,GAAD,CAFM,CAAT;EAIA,IAAMS,QAAQ,GAAGb,MAAM,EAAvB;EAEA,IAAMc,IAAI,GAAGhB,WAAW,CAAC,MAAM;IAC7B,IAAI,CAACM,GAAL,EAAU;IAEVW,KAAK;IAEL,IAAMC,GAAG,GAAG,IAAIC,KAAJ,EAAZ;IAEAD,GAAG,CAACZ,GAAJ,GAAUA,GAAV;IAEA,IAAII,WAAJ,EAAiB;MACfQ,GAAG,CAACR,WAAJ,GAAkBA,WAAlB;IACD;IAED,IAAIH,MAAJ,EAAY;MACVW,GAAG,CAACE,MAAJ,GAAab,MAAb;IACD;IAED,IAAII,KAAJ,EAAW;MACTO,GAAG,CAACP,KAAJ,GAAYA,KAAZ;IACD;IAEDO,GAAG,CAACG,MAAJ,GAAcC,KAAD,IAAW;MACtBL,KAAK;MACLH,SAAS,CAAC,QAAD,CAAT;MACAN,MAAM,QAAN,YAAAA,MAAM,CAAIc,KAAJ,CAAN;IACD,CAJD;IAKAJ,GAAG,CAACK,OAAJ,GAAeC,KAAD,IAAW;MACvBP,KAAK;MACLH,SAAS,CAAC,QAAD,CAAT;MACAL,OAAO,QAAP,YAAAA,OAAO,CAAGe,KAAH,CAAP;IACD,CAJD;IAMAT,QAAQ,CAACU,OAAT,GAAmBP,GAAnB;EACD,CAjCuB,EAiCrB,CAACZ,GAAD,EAAMI,WAAN,EAAmBH,MAAnB,EAA2BI,KAA3B,EAAkCH,MAAlC,EAA0CC,OAA1C,CAjCqB,CAAxB;EAmCA,IAAMQ,KAAK,GAAGA,CAAA,KAAM;IAClB,IAAIF,QAAQ,CAACU,OAAb,EAAsB;MACpBV,QAAQ,CAACU,OAAT,CAAiBJ,MAAjB,GAA0B,IAA1B;MACAN,QAAQ,CAACU,OAAT,CAAiBF,OAAjB,GAA2B,IAA3B;MACAR,QAAQ,CAACU,OAAT,GAAmB,IAAnB;IACD;EACF,CAND;EAQA1B,mBAAmB,CAAC,MAAM;IACxB;AACJ;AACA;AACA;IACI,IAAIa,cAAJ,EAAoB,OAAOc,SAAP;IAEpB,IAAIb,MAAM,KAAK,SAAf,EAA0B;MACxBG,IAAI;IACL;IACD,OAAO,MAAM;MACXC,KAAK;IACN,CAFD;EAGD,CAbkB,EAahB,CAACJ,MAAD,EAASG,IAAT,EAAeJ,cAAf,CAbgB,CAAnB;EAeA;AACF;AACA;AACA;;EACE,OAAOA,cAAc,GAAG,QAAH,GAAcC,MAAnC;AACD"},"metadata":{},"sourceType":"module"}