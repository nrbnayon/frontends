{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nimport { useIds } from \"@chakra-ui/hooks\";\nimport { callAllHandlers } from \"@chakra-ui/utils\";\nimport { mergeRefs } from \"@chakra-ui/react-utils\";\nimport { hideOthers } from \"aria-hidden\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { manager, useModalManager } from \"./modal-manager\";\n\n/**\r\n * Modal hook that manages all the logic for the modal dialog widget\r\n * and returns prop getters, state and actions.\r\n *\r\n * @param props\r\n */\nexport function useModal(props) {\n  var {\n    isOpen,\n    onClose,\n    id,\n    closeOnOverlayClick = true,\n    closeOnEsc = true,\n    useInert = true,\n    onOverlayClick: onOverlayClickProp,\n    onEsc\n  } = props;\n  var dialogRef = useRef(null);\n  var overlayRef = useRef(null);\n  var [dialogId, headerId, bodyId] = useIds(id, \"chakra-modal\", \"chakra-modal--header\", \"chakra-modal--body\");\n  /**\r\n   * Hook used to polyfill `aria-modal` for older browsers.\r\n   * It uses `aria-hidden` to all other nodes.\r\n   *\r\n   * @see https://developer.paciellogroup.com/blog/2018/06/the-current-state-of-modal-dialog-accessibility/\r\n   */\n\n  useAriaHidden(dialogRef, isOpen && useInert);\n  /**\r\n   * Hook use to manage multiple or nested modals\r\n   */\n\n  useModalManager(dialogRef, isOpen);\n  var mouseDownTarget = useRef(null);\n  var onMouseDown = useCallback(event => {\n    mouseDownTarget.current = event.target;\n  }, []);\n  var onKeyDown = useCallback(event => {\n    if (event.key === \"Escape\") {\n      event.stopPropagation();\n      if (closeOnEsc) {\n        onClose == null ? void 0 : onClose();\n      }\n      onEsc == null ? void 0 : onEsc();\n    }\n  }, [closeOnEsc, onClose, onEsc]);\n  var [headerMounted, setHeaderMounted] = useState(false);\n  var [bodyMounted, setBodyMounted] = useState(false);\n  var getDialogProps = useCallback(function (props, ref) {\n    if (props === void 0) {\n      props = {};\n    }\n    if (ref === void 0) {\n      ref = null;\n    }\n    return _extends({\n      role: \"dialog\"\n    }, props, {\n      ref: mergeRefs(ref, dialogRef),\n      id: dialogId,\n      tabIndex: -1,\n      \"aria-modal\": true,\n      \"aria-labelledby\": headerMounted ? headerId : undefined,\n      \"aria-describedby\": bodyMounted ? bodyId : undefined,\n      onClick: callAllHandlers(props.onClick, event => event.stopPropagation())\n    });\n  }, [bodyId, bodyMounted, dialogId, headerId, headerMounted]);\n  var onOverlayClick = useCallback(event => {\n    event.stopPropagation();\n    /**\r\n     * Make sure the event starts and ends on the same DOM element.\r\n     *\r\n     * This is used to prevent the modal from closing when you\r\n     * start dragging from the content, and release drag outside the content.\r\n     *\r\n     * We prevent this because it is technically not a considered \"click outside\"\r\n     */\n\n    if (mouseDownTarget.current !== event.target) return;\n    /**\r\n     * When you click on the overlay, we want to remove only the topmost modal\r\n     */\n\n    if (!manager.isTopModal(dialogRef)) return;\n    if (closeOnOverlayClick) {\n      onClose == null ? void 0 : onClose();\n    }\n    onOverlayClickProp == null ? void 0 : onOverlayClickProp();\n  }, [onClose, closeOnOverlayClick, onOverlayClickProp]);\n  var getDialogContainerProps = useCallback(function (props, ref) {\n    if (props === void 0) {\n      props = {};\n    }\n    if (ref === void 0) {\n      ref = null;\n    }\n    return _extends({}, props, {\n      ref: mergeRefs(ref, overlayRef),\n      onClick: callAllHandlers(props.onClick, onOverlayClick),\n      onKeyDown: callAllHandlers(props.onKeyDown, onKeyDown),\n      onMouseDown: callAllHandlers(props.onMouseDown, onMouseDown)\n    });\n  }, [onKeyDown, onMouseDown, onOverlayClick]);\n  return {\n    isOpen,\n    onClose,\n    headerId,\n    bodyId,\n    setBodyMounted,\n    setHeaderMounted,\n    dialogRef,\n    overlayRef,\n    getDialogProps,\n    getDialogContainerProps\n  };\n}\n\n/**\r\n * Modal hook to polyfill `aria-modal`.\r\n *\r\n * It applies `aria-hidden` to elements behind the modal\r\n * to indicate that they're `inert`.\r\n *\r\n * @param ref React ref of the node\r\n * @param shouldHide whether `aria-hidden` should be applied\r\n */\nexport function useAriaHidden(ref, shouldHide) {\n  useEffect(() => {\n    if (!ref.current) return undefined;\n    var undo = null;\n    if (shouldHide && ref.current) {\n      undo = hideOthers(ref.current);\n    }\n    return () => {\n      if (shouldHide) {\n        undo == null ? void 0 : undo();\n      }\n    };\n  }, [shouldHide, ref]);\n}","map":{"version":3,"names":["useIds","callAllHandlers","mergeRefs","hideOthers","useCallback","useEffect","useRef","useState","manager","useModalManager","useModal","props","isOpen","onClose","id","closeOnOverlayClick","closeOnEsc","useInert","onOverlayClick","onOverlayClickProp","onEsc","dialogRef","overlayRef","dialogId","headerId","bodyId","useAriaHidden","mouseDownTarget","onMouseDown","event","current","target","onKeyDown","key","stopPropagation","headerMounted","setHeaderMounted","bodyMounted","setBodyMounted","getDialogProps","ref","_extends","role","tabIndex","undefined","onClick","isTopModal","getDialogContainerProps","shouldHide","undo"],"sources":["../../src/use-modal.ts"],"sourcesContent":["import { useIds } from \"@chakra-ui/hooks\"\nimport { callAllHandlers } from \"@chakra-ui/utils\"\nimport { mergeRefs, PropGetter } from \"@chakra-ui/react-utils\"\nimport { hideOthers, Undo } from \"aria-hidden\"\nimport {\n  KeyboardEvent,\n  MouseEvent,\n  RefObject,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport { manager, useModalManager } from \"./modal-manager\"\n\nexport interface UseModalProps {\n  /**\n   * If `true`, the modal will be open.\n   */\n  isOpen: boolean\n  /**\n   * The `id` of the modal\n   */\n  id?: string\n  /**\n   * Callback invoked to close the modal.\n   */\n  onClose(): void\n  /**\n   * If `true`, the modal will close when the overlay is clicked\n   * @default true\n   */\n  closeOnOverlayClick?: boolean\n  /**\n   * If `true`, the modal will close when the `Esc` key is pressed\n   * @default true\n   */\n  closeOnEsc?: boolean\n  /**\n   * Callback fired when the overlay is clicked.\n   */\n  onOverlayClick?(): void\n  /**\n   * Callback fired when the escape key is pressed and focus is within modal\n   */\n  onEsc?(): void\n  /**\n   * A11y: If `true`, the siblings of the `modal` will have `aria-hidden`\n   * set to `true` so that screen readers can only see the `modal`.\n   *\n   * This is commonly known as making the other elements **inert**\n   *\n   *  @default true\n   */\n  useInert?: boolean\n}\n\n/**\n * Modal hook that manages all the logic for the modal dialog widget\n * and returns prop getters, state and actions.\n *\n * @param props\n */\nexport function useModal(props: UseModalProps) {\n  const {\n    isOpen,\n    onClose,\n    id,\n    closeOnOverlayClick = true,\n    closeOnEsc = true,\n    useInert = true,\n    onOverlayClick: onOverlayClickProp,\n    onEsc,\n  } = props\n\n  const dialogRef = useRef<HTMLElement>(null)\n  const overlayRef = useRef<HTMLElement>(null)\n\n  const [dialogId, headerId, bodyId] = useIds(\n    id,\n    `chakra-modal`,\n    `chakra-modal--header`,\n    `chakra-modal--body`,\n  )\n\n  /**\n   * Hook used to polyfill `aria-modal` for older browsers.\n   * It uses `aria-hidden` to all other nodes.\n   *\n   * @see https://developer.paciellogroup.com/blog/2018/06/the-current-state-of-modal-dialog-accessibility/\n   */\n  useAriaHidden(dialogRef, isOpen && useInert)\n  /**\n   * Hook use to manage multiple or nested modals\n   */\n  useModalManager(dialogRef, isOpen)\n\n  const mouseDownTarget = useRef<EventTarget | null>(null)\n\n  const onMouseDown = useCallback((event: MouseEvent) => {\n    mouseDownTarget.current = event.target\n  }, [])\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.stopPropagation()\n\n        if (closeOnEsc) {\n          onClose?.()\n        }\n\n        onEsc?.()\n      }\n    },\n    [closeOnEsc, onClose, onEsc],\n  )\n\n  const [headerMounted, setHeaderMounted] = useState(false)\n  const [bodyMounted, setBodyMounted] = useState(false)\n\n  const getDialogProps: PropGetter = useCallback(\n    (props = {}, ref = null) => ({\n      role: \"dialog\",\n      ...props,\n      ref: mergeRefs(ref, dialogRef),\n      id: dialogId,\n      tabIndex: -1,\n      \"aria-modal\": true,\n      \"aria-labelledby\": headerMounted ? headerId : undefined,\n      \"aria-describedby\": bodyMounted ? bodyId : undefined,\n      onClick: callAllHandlers(props.onClick, (event: MouseEvent) =>\n        event.stopPropagation(),\n      ),\n    }),\n    [bodyId, bodyMounted, dialogId, headerId, headerMounted],\n  )\n\n  const onOverlayClick = useCallback(\n    (event: MouseEvent) => {\n      event.stopPropagation()\n      /**\n       * Make sure the event starts and ends on the same DOM element.\n       *\n       * This is used to prevent the modal from closing when you\n       * start dragging from the content, and release drag outside the content.\n       *\n       * We prevent this because it is technically not a considered \"click outside\"\n       */\n      if (mouseDownTarget.current !== event.target) return\n\n      /**\n       * When you click on the overlay, we want to remove only the topmost modal\n       */\n      if (!manager.isTopModal(dialogRef)) return\n\n      if (closeOnOverlayClick) {\n        onClose?.()\n      }\n\n      onOverlayClickProp?.()\n    },\n    [onClose, closeOnOverlayClick, onOverlayClickProp],\n  )\n\n  const getDialogContainerProps: PropGetter = useCallback(\n    (props = {}, ref = null) => ({\n      ...props,\n      ref: mergeRefs(ref, overlayRef),\n      onClick: callAllHandlers(props.onClick, onOverlayClick),\n      onKeyDown: callAllHandlers(props.onKeyDown, onKeyDown),\n      onMouseDown: callAllHandlers(props.onMouseDown, onMouseDown),\n    }),\n    [onKeyDown, onMouseDown, onOverlayClick],\n  )\n\n  return {\n    isOpen,\n    onClose,\n    headerId,\n    bodyId,\n    setBodyMounted,\n    setHeaderMounted,\n    dialogRef,\n    overlayRef,\n    getDialogProps,\n    getDialogContainerProps,\n  }\n}\n\nexport type UseModalReturn = ReturnType<typeof useModal>\n\n/**\n * Modal hook to polyfill `aria-modal`.\n *\n * It applies `aria-hidden` to elements behind the modal\n * to indicate that they're `inert`.\n *\n * @param ref React ref of the node\n * @param shouldHide whether `aria-hidden` should be applied\n */\nexport function useAriaHidden(\n  ref: RefObject<HTMLElement>,\n  shouldHide: boolean,\n) {\n  useEffect(() => {\n    if (!ref.current) return undefined\n\n    let undo: Undo | null = null\n\n    if (shouldHide && ref.current) {\n      undo = hideOthers(ref.current)\n    }\n\n    return () => {\n      if (shouldHide) {\n        undo?.()\n      }\n    }\n  }, [shouldHide, ref])\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}